# コミット・プッシュ実行

## 目的

現在の変更内容を確認し、適切なコミットメッセージを生成してコミットを実行し、リモートにプッシュする

## 実行手順

1. **ツール選択**

   - Git の MCP ツールが利用可能か確認
   - 利用不可の場合は git コマンドを使用

2. **変更内容確認**

   - MCP ツール利用時: Git の MCP ツールでステータスと差分を取得
   - git コマンド利用時: `git status` と `git diff` で変更内容を取得
   - 変更がない場合:
     → 「コミット可能な変更がありません」と通知して終了

3. **ステージング確認**

   - ステージングされていないファイルがある場合:
     → 全ての変更をステージングするか、ユーザーに確認
   - ユーザーが指定する場合はその指示に従う
   - 指定がない場合は全ての変更をステージング

4. **コミットメッセージ生成**

   - 変更内容を分析し、以下を日本語で作成:
     - タイトル: 変更の要点を 1 行で要約(50 文字以内)
     - 本文(変更が複雑な場合のみ):
       - 変更の詳細
       - 変更理由(推測可能な場合)
       - 影響範囲
   - 感情表現や装飾表現は排除し、事実のみ記載
   - 複数の独立した変更がある場合はユーザーに分割を提案

5. **コミット実行**

   - MCP ツール利用時: Git の MCP ツールでコミットを実行
   - git コマンド利用時: `git commit -m "[タイトル]" -m "[本文]"` でコミットを実行

6. **現在のブランチ確認**

   - MCP ツール利用時: Git の MCP ツールで現在のブランチ名を取得
   - git コマンド利用時: `git branch --show-current` でブランチ名を取得

7. **プッシュ実行**

   - MCP ツール利用時: Git の MCP ツールでプッシュを実行
   - git コマンド利用時: `git push origin [ブランチ名]` でプッシュを実行
   - リモートブランチが存在しない場合: `git push -u origin [ブランチ名]` で新規作成

8. **結果通知**
   - コミットハッシュを出力
   - コミットメッセージを出力
   - プッシュ先ブランチを出力
   - 作成完了メッセージのみ表示

## コミットメッセージ生成ルール

### タイトル生成

- 変更の種類を明確に:
  - 機能追加: 「[機能名]を追加」
  - バグ修正: 「[対象]の[問題]を修正」
  - リファクタリング: 「[対象]をリファクタリング」
  - ドキュメント: 「[対象]のドキュメントを更新」
  - スタイル: 「[対象]のスタイルを修正」
  - テスト: 「[対象]のテストを追加」
  - 設定: 「[設定名]を更新」

### 本文生成(以下の場合のみ)

- 変更が 3 ファイル以上
- ロジック変更を含む
- 破壊的変更を含む
- 複雑な修正

## エラーハンドリング

- 変更がステージングされていない → 全てステージングするか確認
- コミット可能な変更がない → ユーザーに通知して終了
- git リポジトリでない → 「git リポジトリではありません」と通知して終了
- プッシュでコンフリクト発生 → エラー内容を通知してユーザーに対応を依頼
- リモートが設定されていない → 「リモートリポジトリが設定されていません」と通知して終了
- MCP ツールと git コマンド両方が利用不可 → その旨を通知して終了

## ユーザー確認が必要なケース

以下の場合はコミット前にユーザーに確認:

1. 複数の独立した変更が混在している
2. 設定ファイルの変更が含まれる
3. 大量のファイル変更(10 ファイル以上)
4. 破壊的変更の可能性がある

確認時の出力内容:

- 変更ファイル一覧
- 生成されたコミットメッセージ
- 「このままコミット・プッシュしますか?」

## 制約

- 優先順位: Git の MCP ツール > git コマンド
- 全ての出力は日本語
- コミットメッセージは簡潔かつ明確に
- force push は実行しない
